#!/usr/bin/env ruby
require 'help_parser'

OPTIONS = HelpParser['0.0.210226', <<HELP]
Usage:
  korekto [:options+]
Options:
 -h --help
 -v --version
 -V --verbose
 --install   \tInstalls the korecto neovim ruby plugin
# Example usage:
#   cat README.md | korekto
#   korekto < README.md
HELP

if OPTIONS.install?
  require 'fileutils'
  # pack
  dest = File.expand_path '~/.local/share/nvim/site/pack/korekto'
  FileUtils.mkdir_p dest
  src = File.join File.dirname(__dir__), 'start'
  FileUtils.cp_r src, dest
  # rplugin
  dest = File.expand_path '~/.config/nvim'
  src = File.join File.dirname(__dir__), 'rplugin'
  FileUtils.cp_r src, dest
  system "nvim -c ':UpdateRemotePlugins|:quit' > /dev/null"
  exit
end

require 'korekto'
Korekto.run
