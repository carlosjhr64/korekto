#!/usr/bin/env ruby
# frozen_string_literal: true

require 'test/unit'
require 'colorize'

module Korekto
  class Error < RuntimeError; end
end
require 'korekto/refinements'
require 'korekto/syntax'

class TestSyntax < Test::Unit::TestCase
  # rubocop: disable Metrics
  def test_sytax
    syntax = Korekto::Syntax.new
    syntax.push 'length < 120'
    assert_equal ['length < 120'], syntax.to_a
    error = assert_raises(Korekto::Error) do
      syntax.push 'length'
    end
    assert_equal 'syntax must eval boolean', error.message
    error = assert_raises(Korekto::Error) do
      syntax.push 'leNgTh < 120'
    end
    assert_equal 'NameError: leNgTh < 120', error.message
    syntax.push 'is_a? String'
    assert_nothing_raised do
      syntax.check('ABC')
    end
  end

  # No fail warnings
  def test_instance_methods_coverage
    klass = Korekto::Syntax
    methods = klass.instance_methods(false) +
              klass.private_instance_methods(false)
    methods.each do |method|
      test_method = "test_#{method}"
      test_method.sub!(/=$/, '_set')
      test_method.sub!(/!$/, '_bang')
      test_method.sub!(/\?$/, '_wut')
      next if respond_to? test_method.to_sym

      puts "Missing #{self.class}##{test_method}".red
    end
  end
  # rubocop: enable Metrics
end
